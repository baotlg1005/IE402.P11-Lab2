<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<title>3D - Building Map</title>

	<style>
		html,
		body,
		#viewDiv {
			padding: 0;
			margin: 0;
			height: 100%;
			width: 100%;
		}
	</style>

	<link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
	<script src="https://js.arcgis.com/4.29/"></script>
	
	<script src="utils.js"></script>
	<script src="render.js"></script>
	<script src="draw.js"></script>
	<script src="getPoint.js"></script>

	<script>

		let mview;

		Render();

		console.log(jsondata);

		require([
			"esri/Map",
			"esri/views/SceneView",
			"esri/layers/GraphicsLayer",
			"esri/Graphic",
		], function (
			Map, SceneView, GraphicsLayer, Graphic
		) {

			const map = new Map({
				basemap: "topo-vector",
				ground: "world-elevation"
			});

			const view = new SceneView({
				container: "viewDiv",
				map: map,
				camera: {
					position: [106.80226887464666, 10.871045829514076, 64.97129604406655], heading: 128.39578097430217, tilt: 75.14149746414613
				}
			});

			mview = view;
			var createGraphic = function (data) {
				return new Graphic({
					geometry: data,
					symbol: data.symbol,
					attributes: data,
				});
			};
			var graphicsLayer = new GraphicsLayer();

			jsondata.points.forEach(function (data) {
				graphicsLayer.add(createGraphic(data));
			});
			jsondata.polygons.forEach(function (data) {
				graphicsLayer.add(createGraphic(data));
			});
			jsondata.polyline.forEach(function (data) {
                graphicsLayer.add(createGraphic(data));
            });

			map.add(graphicsLayer);

			setupGetPoint(view, graphicsLayer);
		});

		function GetCameraPos() {
			let pos = mview.camera.position;
			//change pos to lat, long
			let lat = pos.latitude;
			let long = pos.longitude;
			console.log("position: [" + long + ", " + lat + ", " + pos.z + "], heading: " + mview.camera.heading + ", tilt: " + mview.camera.tilt);
		}

	</script>
</head>

<body>
	<div id="viewDiv"></div>
</body>

</html>